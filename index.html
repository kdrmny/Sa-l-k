<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Meditek - Saƒülƒ±k Tedarik Platformu</title>
<style>
/* ====== RESET ====== */
* {margin:0;padding:0;box-sizing:border-box}
:root{
  --primary:#000;            /* metin ana */
  --secondary:#333;
  --background:#fff;         /* arka plan */
  --glass:rgba(255,255,255,.78);
  --glass-bd:rgba(0,0,0,.08);
  --surface:rgba(255,255,255,.88);
  --border:#e5e5e5;
  --muted:#8a8a8a;
  --shadow:0 10px 30px rgba(0,0,0,.08);
  --accent:#111;             /* buton-kenar vurgusu */
  --success:#16a34a;
  --warn:#d97706;
}
html[data-theme="dark"]{
  --primary:#eaeaea;
  --secondary:#bdbdbd;
  --background:#1a1a1a;
  --glass:rgba(26,26,26,.78);
  --glass-bd:rgba(255,255,255,.12);
  --surface:rgba(30,30,30,.84);
  --border:#333;
  --muted:#9a9a9a;
  --shadow:0 16px 40px rgba(0,0,0,.45);
  --accent:#eaeaea;
}
body{
  font-family:-apple-system,BlinkMacSystemFont,'SF Pro Text','Segoe UI',Roboto,Arial,sans-serif;
  background:
    radial-gradient(1200px 600px at 20% 80%, rgba(100,120,160,.08), transparent 60%),
    radial-gradient(1000px 500px at 80% 10%, rgba(160,100,130,.06), transparent 60%),
    var(--background);
  color:var(--primary);
  line-height:1.6;
  min-height:100vh;
}

/* ====== NAVBAR ====== */
.navbar{
  position:fixed;left:50%;top:16px;transform:translateX(-50%);
  width:96%;max-width:1200px;z-index:1000;
  background:rgba(255,255,255,.66);
  -webkit-backdrop-filter:blur(18px) saturate(.9);
  backdrop-filter:blur(18px) saturate(.9);
  border:1px solid var(--glass-bd);
  border-radius:20px;padding:10px 14px;box-shadow:var(--shadow);
}
html[data-theme="dark"] .navbar{background:rgba(26,26,26,.75)}
.nav-row{display:flex;align-items:center;gap:10px}
.logo{font-weight:800;letter-spacing:.3px;font-size:18px;padding:6px 10px;border-radius:12px}
.logo b{font-weight:900}
.nav-spacer{flex:1}
.nav-links{display:flex;gap:4px;list-style:none}
.nav-link{
  padding:8px 12px;border-radius:14px;text-decoration:none;color:var(--secondary);
  border:1px solid transparent;transition:.2s;
}
.nav-link:hover,.nav-link.active{color:var(--primary);background:rgba(127,127,127,.08);border-color:var(--glass-bd)}
.theme-btn{
  border:1px solid var(--border);background:transparent;color:var(--primary);
  padding:8px 10px;border-radius:12px;cursor:pointer;transition:.2s;
}
.theme-btn:hover{background:rgba(127,127,127,.08)}

/* ====== CATEGORY DRAWER (LEFT) ====== */
.drawer-toggle{
  border:1px solid var(--border);background:var(--surface);color:var(--primary);
  padding:8px 12px;border-radius:12px;cursor:pointer;transition:.2s;display:flex;align-items:center;gap:8px;
}
.drawer-toggle:hover{transform:translateY(-1px)}
.drawer{
  position:fixed;inset:0 auto 0 0;width:300px;max-width:86vw;transform:translateX(-110%);
  background:var(--glass);-webkit-backdrop-filter:blur(18px) saturate(.9);backdrop-filter:blur(18px) saturate(.9);
  border-right:1px solid var(--glass-bd);box-shadow:var(--shadow);z-index:1200;transition:transform .28s ease;
}
.drawer.open{transform:translateX(0)}
.drawer-head{display:flex;align-items:center;justify-content:space-between;padding:16px;border-bottom:1px solid var(--glass-bd)}
.drawer-title{font-weight:700}
.drawer-body{padding:14px}
.filter-group{margin-bottom:18px}
.group-title{font-size:12px;text-transform:uppercase;letter-spacing:.08em;color:var(--muted);margin-bottom:8px}
.chip{
  display:inline-flex;align-items:center;gap:8px;padding:8px 12px;margin:6px 6px 0 0;border-radius:999px;
  border:1px solid var(--border);background:var(--surface);cursor:pointer;transition:.2s;font-size:14px;
}
.chip.active{border-color:var(--accent)}
.search-box{display:flex;gap:8px;margin-top:10px}
.input{
  flex:1;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:var(--background);color:var(--primary);
}
.apply-btn{padding:10px 12px;border-radius:10px;border:1px solid var(--accent);background:transparent;color:var(--primary);cursor:pointer}

/* overlay */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.25);backdrop-filter:blur(2px);z-index:1100;opacity:0;pointer-events:none;transition:.25s}
.overlay.show{opacity:1;pointer-events:auto}

/* ====== CONTAINER / PAGES ====== */
.container{max-width:1200px;margin:0 auto;padding:100px 16px 40px}
.page{display:none}
.page.active{display:block}

/* ====== HERO (HOME) ====== */
.hero{margin-top:36px;margin-bottom:22px;display:flex;align-items:center;gap:14px;flex-wrap:wrap}
.hero h1{
  font-size:28px;font-weight:800;letter-spacing:.2px;
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  -webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;
}
.hero-sub{color:var(--secondary)}
.pilot{
  background:rgba(22,163,74,.10);border:1px solid rgba(22,163,74,.25);
  padding:8px 12px;border-radius:12px;font-weight:600;color:var(--success)
}

/* ====== SUPPLIER SHOWCASE ====== */
.grid{display:grid;gap:16px}
.grid-3{grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
.card{
  background:var(--surface);border:1px solid var(--glass-bd);border-radius:18px;padding:16px;box-shadow:var(--shadow);transition:.2s;
}
.card:hover{transform:translateY(-4px)}
.card-head{display:flex;align-items:center;gap:12px;margin-bottom:10px}
.logo-badge{
  width:40px;height:40px;border-radius:12px;border:1px solid var(--border);display:grid;place-items:center;
  background:linear-gradient(180deg,rgba(255,255,255,.6),rgba(255,255,255,.3));
}
.s-name{font-weight:700}
.s-meta{font-size:12px;color:var(--muted)}
.pill{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid var(--border);font-size:12px;color:var(--secondary);margin-right:6px}
.row{display:flex;gap:8px;flex-wrap:wrap}
.cta{margin-top:12px;display:flex;gap:8px}
.btn{
  border:1px solid var(--accent);background:transparent;color:var(--primary);
  padding:10px 12px;border-radius:12px;cursor:pointer;transition:.2s;font-weight:600;
}
.btn:hover{transform:translateY(-1px)}
.badges{margin-top:10px;display:flex;gap:6px;flex-wrap:wrap}
.badge{font-size:11px;border:1px solid var(--border);padding:4px 8px;border-radius:999px}
.price-hint{margin-top:8px;font-size:12px;color:var(--muted)}

/* ====== SECTIONS (kept) ====== */
.section{background:var(--glass);-webkit-backdrop-filter:blur(18px) saturate(.9);backdrop-filter:blur(18px) saturate(.9);border:1px solid var(--glass-bd);border-radius:18px;padding:20px;margin-bottom:18px}
.section h2{font-size:20px;margin-bottom:6px}

/* forms */
.form{display:grid;gap:12px}
.label{font-weight:700;font-size:14px}
.input, .select, .textarea{width:100%}
.textarea{min-height:110px;padding:12px;border-radius:12px;border:1px solid var(--border);background:var(--background);color:var(--primary)}

/* table simple */
.table-wrap{overflow:auto;border:1px solid var(--border);border-radius:12px}
table{width:100%;border-collapse:collapse;background:var(--background)}
th,td{padding:12px;border-bottom:1px solid var(--border);text-align:left}
th{font-size:13px;color:var(--secondary)}

/* responsive */
@media (max-width:768px){
  .nav-links{display:none}
  .container{padding-top:100px}
  .grid-3{grid-template-columns:1fr}
}
</style>
</head>
<body>

<!-- ===== NAVBAR ===== -->
<nav class="navbar">
  <div class="nav-row">
    <button class="drawer-toggle" id="drawerBtn">‚ò∞ Kategoriler</button>
    <div class="logo">Meditek</div>
    <div class="nav-spacer"></div>
    <ul class="nav-links">
      <li><a href="#" class="nav-link active" data-page="home">Ana Sayfa</a></li>
      <li><a href="#" class="nav-link" data-page="clinics">Klinikler</a></li>
      <li><a href="#" class="nav-link" data-page="suppliers">Tedarik√ßiler</a></li>
      <li><a href="#" class="nav-link" data-page="requests">Talepler</a></li>
      <li><a href="#" class="nav-link" data-page="veterinary">Veteriner</a></li>
      <li><a href="#" class="nav-link" data-page="beauty">G√ºzellik</a></li>
      <li><a href="#" class="nav-link" data-page="admin">Admin</a></li>
      <li><a href="#" class="nav-link" data-page="demo">Demo</a></li>
    </ul>
    <button class="theme-btn" id="themeBtn" title="Tema">üåô</button>
  </div>
</nav>

<!-- ===== LEFT DRAWER + OVERLAY ===== -->
<aside class="drawer" id="drawer">
  <div class="drawer-head">
    <div class="drawer-title">Filtreler</div>
    <button class="theme-btn" id="drawerClose">‚úï</button>
  </div>
  <div class="drawer-body">
    <div class="filter-group">
      <div class="group-title">Kategori</div>
      <div id="chipGroup">
        <!-- chips JS ile doldurulur -->
      </div>
    </div>
    <div class="filter-group">
      <div class="group-title">Arama</div>
      <div class="search-box">
        <input class="input" id="searchInput" placeholder="Tedarik√ßi, √ºr√ºn, ≈üehir..." />
        <button class="apply-btn" id="applySearch">Uygula</button>
      </div>
    </div>
    <div class="filter-group">
      <div class="group-title">Etiket</div>
      <div id="tagGroup">
        <span class="chip" data-tag="CE">CE</span>
        <span class="chip" data-tag="ISO">ISO</span>
        <span class="chip" data-tag="Tƒ∞TUBB">Tƒ∞TUBB</span>
        <span class="chip" data-tag="FDA">FDA</span>
      </div>
    </div>
  </div>
</aside>
<div class="overlay" id="overlay"></div>

<!-- ===== CONTAINER ===== -->
<main class="container">

  <!-- ===== HOME: TEDARƒ∞K√áƒ∞ Vƒ∞TRƒ∞Nƒ∞ ===== -->
  <section id="home" class="page active">
    <div class="hero">
      <h1>Tedarik√ßi Vitrini</h1>
      <span class="hero-sub">≈ûeffaf, hƒ±zlƒ± ve g√ºvenli tedarik aƒüƒ±</span>
      <span class="pilot">üéØ Pilot √ºcretsiz ‚Äì g√ºvenle deneyin</span>
    </div>

    <div class="section">
      <div class="row" style="justify-content:space-between;align-items:center">
        <div class="row" id="activeFilters"></div>
        <div class="row">
          <button class="btn" id="clearFilters">Filtreleri Temizle</button>
        </div>
      </div>
    </div>

    <div class="grid grid-3" id="supplierGrid">
      <!-- Kartlar JS ile doldurulur -->
    </div>
  </section>

  <!-- ===== CLINICS ===== -->
  <section id="clinics" class="page">
    <div class="section">
      <h2>Klinik & Hastane Paneli</h2>
      <p>ƒ∞htiyacƒ±nƒ±zƒ± girin, tedarik√ßiler teklif versin.</p>
    </div>
    <div class="section">
      <h3>Yeni Talep</h3>
      <form id="clinicForm" class="form">
        <label class="label">√úr√ºn Adƒ±</label>
        <input class="input" id="cName" required />
        <label class="label">Kategori</label>
        <select class="input" id="cCat" required>
          <option value="">Se√ßiniz</option>
          <option value="medical-device">Tƒ±bbi Cihaz</option>
          <option value="consumables">Sarf</option>
          <option value="laboratory">Laboratuvar</option>
          <option value="imaging">G√∂r√ºnt√ºleme</option>
        </select>
        <label class="label">Miktar</label>
        <input type="number" class="input" id="cQty" min="1" value="1" required />
        <label class="label">A√ßƒ±klama</label>
        <textarea class="textarea" id="cDesc" placeholder="Marka/model, sertifika, teslim ko≈üulu‚Ä¶"></textarea>
        <button class="btn" type="submit">Talep Olu≈ütur</button>
      </form>
    </div>
    <div class="section">
      <h3>Aktif Taleplerim</h3>
      <div class="table-wrap">
        <table>
          <thead><tr><th>ID</th><th>√úr√ºn</th><th>Kat.</th><th>Miktar</th><th>Durum</th><th>Tarih</th></tr></thead>
          <tbody id="clinicList"><tr><td colspan="6">Kayƒ±t yok</td></tr></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- ===== SUPPLIERS ===== -->
  <section id="suppliers" class="page">
    <div class="section"><h2>Tedarik√ßi Paneli</h2><p>Vitrinde g√∂r√ºnmek i√ßin kaydolun, taleplere teklif verin.</p></div>
    <div class="section">
      <h3>Tedarik√ßi Kaydƒ±</h3>
      <form id="supForm" class="form">
        <label class="label">≈ûirket Adƒ±</label>
        <input class="input" id="sName" required />
        <label class="label">≈ûehir</label>
        <input class="input" id="sCity" placeholder="ƒ∞stanbul, ƒ∞zmir‚Ä¶" />
        <label class="label">Uzmanlƒ±klar (Ctrl/Cmd ile √ßoklu se√ß)</label>
        <select class="input" id="sSpec" multiple>
          <option value="medical-device">Tƒ±bbi Cihaz</option>
          <option value="consumables">Sarf</option>
          <option value="laboratory">Laboratuvar</option>
          <option value="imaging">G√∂r√ºnt√ºleme</option>
          <option value="veterinary">Veteriner</option>
          <option value="beauty">G√ºzellik</option>
        </select>
        <label class="label">Sertifikalar</label>
        <div class="row">
          <label class="chip"><input type="checkbox" value="CE"> CE</label>
          <label class="chip"><input type="checkbox" value="ISO"> ISO</label>
          <label class="chip"><input type="checkbox" value="Tƒ∞TUBB"> Tƒ∞TUBB</label>
          <label class="chip"><input type="checkbox" value="FDA"> FDA</label>
        </div>
        <label class="label">Kƒ±sa A√ßƒ±klama</label>
        <textarea class="textarea" id="sAbout" placeholder="√ñrn. Ultrason ve EKG cihazlarƒ±nda yetkili satƒ±cƒ±"></textarea>
        <button class="btn" type="submit">Kaydƒ± Tamamla</button>
      </form>
    </div>
    <div class="section">
      <h3>Vitrindeki Kaydƒ±m</h3>
      <div id="mySupplier">Hen√ºz kayƒ±t yok.</div>
    </div>
  </section>

  <!-- ===== REQUESTS ===== -->
  <section id="requests" class="page">
    <div class="section"><h2>Talepler & Teklifler</h2></div>
    <div class="section">
      <h3>Son Talepler</h3>
      <div class="table-wrap">
        <table>
          <thead><tr><th>ID</th><th>√úr√ºn</th><th>Kategori</th><th>Miktar</th><th>Durum</th></tr></thead>
          <tbody id="allReq"><tr><td colspan="5">Veri yok</td></tr></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- ===== VETERINARY ===== -->
  <section id="veterinary" class="page">
    <div class="section"><h2>Veteriner Paneli</h2><p>Veteriner sarf ve ekipman talebi olu≈üturun.</p></div>
    <div class="section">
      <h3>Yeni Talep</h3>
      <form id="vetForm" class="form">
        <label class="label">√úr√ºn</label><input class="input" id="vName" required/>
        <label class="label">Kategori</label>
        <select class="input" id="vCat" required>
          <option value="">Se√ßiniz</option>
          <option value="surgery">Cerrahi</option>
          <option value="diagnosis">Tanƒ±</option>
          <option value="medication">ƒ∞la√ß/A≈üƒ±</option>
        </select>
        <label class="label">Miktar</label><input type="number" class="input" id="vQty" value="1" min="1" required/>
        <button class="btn" type="submit">Talep Olu≈ütur</button>
      </form>
    </div>
  </section>

  <!-- ===== BEAUTY ===== -->
  <section id="beauty" class="page">
    <div class="section"><h2>G√ºzellik & Epilasyon</h2><p>Lazer, dermokozmetik vb. i√ßin talep a√ßƒ±n.</p></div>
    <div class="section">
      <h3>Yeni Talep</h3>
      <form id="bForm" class="form">
        <label class="label">√úr√ºn</label><input class="input" id="bName" required/>
        <label class="label">Kategori</label>
        <select class="input" id="bCat" required>
          <option value="">Se√ßiniz</option>
          <option value="laser">Lazer</option>
          <option value="skincare">Cilt Bakƒ±m</option>
          <option value="consumables">Sarf</option>
        </select>
        <label class="label">Miktar</label><input type="number" class="input" id="bQty" value="1" min="1" required/>
        <button class="btn" type="submit">Talep Olu≈ütur</button>
      </form>
    </div>
  </section>

  <!-- ===== ADMIN (√∂zet) ===== -->
  <section id="admin" class="page">
    <div class="section"><h2>Admin Paneli</h2><p>√ñzet metrikler ve i≈ülemler.</p></div>
    <div class="section">
      <div class="table-wrap">
        <table>
          <thead><tr><th>ID</th><th>T√ºr</th><th>Ad</th><th>Kategori/Uzmanlƒ±k</th><th>Tarih</th></tr></thead>
          <tbody id="adminTbl"><tr><td colspan="5">Veri yok</td></tr></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- ===== DEMO ===== -->
  <section id="demo" class="page">
    <div class="section">
      <h2>Demo</h2>
      <p>Bu b√∂l√ºm demo verilerle √ßalƒ±≈üƒ±r; ger√ßek i≈ülem deƒüildir.</p>
    </div>
  </section>

</main>

<script>
/* ============ STORAGE HELPERS ============ */
const LS = {
  get(key, fallback){ try{ return JSON.parse(localStorage.getItem(key)) ?? fallback }catch{ return fallback } },
  set(key,val){ localStorage.setItem(key, JSON.stringify(val)) }
};

/* ============ DATA SEEDS ============ */
function seedSuppliersIfEmpty(){
  const ex = LS.get('suppliers', []);
  if(ex.length) return;
  const seed = [
    {id:'s1', name:'MediTech Solutions', city:'ƒ∞stanbul', specs:['medical-device','imaging'], tags:['CE','ISO'], about:'Ultrason & EKG cihazlarƒ±nda yetkili satƒ±cƒ±', hint:'Ultrason 150-500 bin TL'},
    {id:'s2', name:'Saƒülƒ±kPlus A.≈û.', city:'Ankara', specs:['consumables','laboratory'], tags:['CE','Tƒ∞TUBB'], about:'Sarf & lab kitleri hƒ±zlƒ± teslim', hint:'Sarf kit 25-80 TL/adet'},
    {id:'s3', name:'LabPro Medikal', city:'ƒ∞zmir', specs:['laboratory'], tags:['ISO'], about:'Hematoloji, biyokimya kitleri', hint:'Biyokimya kit 800-2.500 TL'},
    {id:'s4', name:'VetSupply Pro', city:'Bursa', specs:['veterinary'], tags:['CE'], about:'Veteriner sarf ve tanƒ± kitleri', hint:'Vet kan kiti 25-80 TL/adet'},
    {id:'s5', name:'BeautyTech Intl', city:'ƒ∞stanbul', specs:['beauty','equipment'], tags:['CE','FDA'], about:'Lazer & estetik cihazlarƒ±', hint:'Lazer ba≈ülƒ±k 500-1.500 TL'},
    {id:'s6', name:'ImageSense', city:'Antalya', specs:['imaging'], tags:['ISO'], about:'R√∂ntgen & USG aksesuar', hint:'Jel 30-60 TL/L'}
  ];
  LS.set('suppliers', seed);
}
function ensureLists(){
  if(!LS.get('suppliers', null)) LS.set('suppliers', []);
  if(!LS.get('requests', null)) LS.set('requests', []);
}

/* ============ STATE ============ */
const State = {
  filters:{ categories:new Set(), tags:new Set(), q:'' }
};

/* ============ UI HELPERS ============ */
function $(sel, all=false){ return all ? document.querySelectorAll(sel) : document.querySelector(sel) }
function setActivePage(id){
  $('.page.active')?.classList.remove('active');
  $('#'+id).classList.add('active');
  $('.nav-link.active')?.classList.remove('active');
  document.querySelector(`.nav-link[data-page="${id}"]`)?.classList.add('active');
  if(id==='home') renderSupplierGrid();
  if(id==='clinics') renderClinicTable();
  if(id==='requests') renderAllReq();
  if(id==='admin') renderAdmin();
}

/* ============ DRAWER ============ */
const drawer = $('#drawer'), overlay = $('#overlay');
$('#drawerBtn').addEventListener('click', ()=>{ drawer.classList.add('open'); overlay.classList.add('show'); });
$('#drawerClose').addEventListener('click', closeDrawer);
overlay.addEventListener('click', closeDrawer);
function closeDrawer(){ drawer.classList.remove('open'); overlay.classList.remove('show'); }

/* Build category chips in drawer */
const categoryMap = [
  {id:'medical-device', label:'Tƒ±bbi Cihaz'},
  {id:'consumables', label:'Sarf'},
  {id:'laboratory', label:'Laboratuvar'},
  {id:'imaging', label:'G√∂r√ºnt√ºleme'},
  {id:'veterinary', label:'Veteriner'},
  {id:'beauty', label:'G√ºzellik'}
];
function buildChips(){
  const wrap = document.createElement('div');
  categoryMap.forEach(c=>{
    const el = document.createElement('span');
    el.className = 'chip'; el.dataset.cat = c.id; el.textContent = c.label;
    el.addEventListener('click', ()=>{
      if(State.filters.categories.has(c.id)) State.filters.categories.delete(c.id);
      else State.filters.categories.add(c.id);
      el.classList.toggle('active');
      renderActiveFilters();
    });
    wrap.appendChild(el);
  });
  $('#chipGroup').appendChild(wrap);
}
$('#tagGroup')?.querySelectorAll('.chip').forEach(ch=>{
  ch.addEventListener('click', ()=>{
    const tag = ch.dataset.tag;
    if(State.filters.tags.has(tag)) State.filters.tags.delete(tag);
    else State.filters.tags.add(tag);
    ch.classList.toggle('active');
    renderActiveFilters();
  });
});
$('#applySearch').addEventListener('click', ()=>{
  State.filters.q = $('#searchInput').value.trim().toLowerCase();
  renderActiveFilters();
});

/* Active filter pills row */
function renderActiveFilters(){
  const row = $('#activeFilters');
  row.innerHTML = '';
  const parts = [];
  if(State.filters.categories.size){
    parts.push(...[...State.filters.categories].map(c=>{
      const lbl = categoryMap.find(x=>x.id===c)?.label || c;
      return `<span class="pill">${lbl} ‚úï</span>`;
    }));
  }
  if(State.filters.tags.size){
    parts.push(...[...State.filters.tags].map(t=>`<span class="pill">${t} ‚úï</span>`));
  }
  if(State.filters.q){
    parts.push(`<span class="pill">"${State.filters.q}" ‚úï</span>`);
  }
  row.innerHTML = parts.join('') || '<span class="s-meta">Filtre uygulanmadƒ±</span>';
  renderSupplierGrid(); // apply
}
$('#clearFilters').addEventListener('click', ()=>{
  State.filters = {categories:new Set(), tags:new Set(), q:''};
  // reset chips ui
  $('#chipGroup').querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
  $('#tagGroup').querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
  $('#searchInput').value='';
  renderActiveFilters();
});

/* ============ SUPPLIER GRID ============ */
function supplierCard(s){
  const tags = (s.tags||[]).map(t=>`<span class="badge">${t}</span>`).join('');
  const cats = (s.specs||[]).map(c=>{
    const lbl = categoryMap.find(x=>x.id===c)?.label || c;
    return `<span class="pill">${lbl}</span>`;
  }).join('');
  return `
  <div class="card">
    <div class="card-head">
      <div class="logo-badge">üè∑Ô∏è</div>
      <div>
        <div class="s-name">${s.name}</div>
        <div class="s-meta">${s.city || '‚Äî'}</div>
      </div>
    </div>
    <div class="row">${cats}</div>
    <p style="margin-top:8px">${s.about || ''}</p>
    <div class="badges">${tags}</div>
    ${s.hint ? `<div class="price-hint">üí° ${s.hint}</div>` : ''}
    <div class="cta">
      <button class="btn" onclick="openRequestTo('${s.id}')">RFQ Olu≈ütur</button>
      <button class="btn" onclick="contactSupplier('${s.id}')">Mesaj G√∂nder</button>
    </div>
  </div>`;
}
function renderSupplierGrid(){
  const grid = $('#supplierGrid');
  const all = LS.get('suppliers', []);
  const f = State.filters;
  const list = all.filter(s=>{
    const byCat = f.categories.size ? s.specs?.some(x=>f.categories.has(x)) : true;
    const byTag = f.tags.size ? s.tags?.some(t=>f.tags.has(t)) : true;
    const byQ = f.q? (s.name?.toLowerCase().includes(f.q) || s.about?.toLowerCase().includes(f.q) || s.city?.toLowerCase().includes(f.q)) : true;
    return byCat && byTag && byQ;
  });
  grid.innerHTML = list.length ? list.map(supplierCard).join('') : `<div class="card"><b>Sonu√ß yok.</b> Filtreleri geni≈ületin.</div>`;
}

/* RFQ quick actions (demo only) */
window.openRequestTo = function(sid){
  setActivePage('clinics');
  $('#cDesc').value = `Hedef tedarik√ßi: ${sid} ‚Äî temel gereksinimler: CE/ISO`;
}
window.contactSupplier = function(sid){
  alert(`Tedarik√ßi ${sid} ile mesajla≈üma (demo).`);
}

/* ============ FORMS & TABLES ============ */
$('#clinicForm')?.addEventListener('submit', e=>{
  e.preventDefault();
  const reqs = LS.get('requests', []);
  const item = {
    id:'R'+Date.now(),
    type:'clinic',
    name:$('#cName').value,
    cat:$('#cCat').value,
    qty:+$('#cQty').value || 1,
    status:'open',
    date:new Date().toISOString()
  };
  reqs.push(item); LS.set('requests', reqs);
  e.target.reset();
  renderClinicTable(); renderAllReq(); renderAdmin();
  alert('Talep kaydedildi.');
});
function renderClinicTable(){
  const mine = LS.get('requests', []).filter(r=>r.type==='clinic');
  const tb = $('#clinicList');
  if(!mine.length){ tb.innerHTML = `<tr><td colspan="6">Kayƒ±t yok</td></tr>`; return; }
  tb.innerHTML = mine.slice(-20).reverse().map(r=>`
    <tr><td>${r.id}</td><td>${r.name}</td><td>${r.cat}</td><td>${r.qty}</td><td>${r.status}</td><td>${new Date(r.date).toLocaleDateString()}</td></tr>
  `).join('');
}
function renderAllReq(){
  const all = LS.get('requests', []);
  const tb = $('#allReq');
  if(!all.length){ tb.innerHTML = `<tr><td colspan="5">Veri yok</td></tr>`; return; }
  tb.innerHTML = all.slice(-30).reverse().map(r=>`
    <tr><td>${r.id}</td><td>${r.name||'-'}</td><td>${r.cat||'-'}</td><td>${r.qty||'-'}</td><td>${r.status}</td></tr>
  `).join('');
}

/* Supplier registration */
$('#supForm')?.addEventListener('submit', e=>{
  e.preventDefault();
  const arr = LS.get('suppliers', []);
  const certs = Array.from(e.target.querySelectorAll('input[type="checkbox"]:checked')).map(i=>i.value);
  const specs = Array.from($('#sSpec').selectedOptions).map(o=>o.value);
  const item = {
    id:'S'+Date.now(),
    name:$('#sName').value,
    city:$('#sCity').value,
    specs, tags:certs, about:$('#sAbout').value
  };
  arr.push(item); LS.set('suppliers', arr);
  e.target.reset();
  renderMySupplier(item.id); renderSupplierGrid(); renderAdmin();
  alert('Tedarik√ßi kaydƒ± tamamlandƒ±. Vitrine eklendi.');
});
function renderMySupplier(newId){
  const arr = LS.get('suppliers', []);
  const last = newId ? arr.find(x=>x.id===newId) : arr[arr.length-1];
  $('#mySupplier').innerHTML = last ? supplierCard(last) : 'Hen√ºz kayƒ±t yok.';
}

/* Admin table (simple feed) */
function renderAdmin(){
  const reqs = LS.get('requests', []);
  const sups = LS.get('suppliers', []);
  const rows = [
    ...reqs.map(r=>({t:'Talep', name:r.name, cat:r.cat, date:r.date, id:r.id})),
    ...sups.map(s=>({t:'Tedarik√ßi', name:s.name, cat:(s.specs||[]).join(','), date:new Date().toISOString(), id:s.id}))
  ].sort((a,b)=>new Date(b.date)-new Date(a.date));
  const tb = $('#adminTbl');
  if(!rows.length){ tb.innerHTML = `<tr><td colspan="5">Veri yok</td></tr>`;return; }
  tb.innerHTML = rows.slice(0,30).map(x=>`
    <tr><td>${x.id}</td><td>${x.t}</td><td>${x.name}</td><td>${x.cat||'-'}</td><td>${new Date(x.date).toLocaleString()}</td></tr>
  `).join('');
}

/* ============ NAV & THEME ============ */
document.querySelectorAll('.nav-link').forEach(a=>{
  a.addEventListener('click', e=>{ e.preventDefault(); setActivePage(a.dataset.page) })
});
function initTheme(){
  const saved = localStorage.getItem('meditek-theme');
  const sysDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  const mode = saved || (sysDark?'dark':'light');
  if(mode==='dark') document.documentElement.setAttribute('data-theme','dark');
  $('#themeBtn').textContent = mode==='dark' ? '‚òÄÔ∏è' : 'üåô';
}
$('#themeBtn').addEventListener('click', ()=>{
  const isDark = document.documentElement.getAttribute('data-theme')==='dark';
  if(isDark){ document.documentElement.removeAttribute('data-theme'); localStorage.setItem('meditek-theme','light'); $('#themeBtn').textContent='üåô'; }
  else { document.documentElement.setAttribute('data-theme','dark'); localStorage.setItem('meditek-theme','dark'); $('#themeBtn').textContent='‚òÄÔ∏è'; }
});

/* ============ INIT ============ */
ensureLists();
seedSuppliersIfEmpty();
buildChips();
initTheme();
renderSupplierGrid();
renderAdmin();
renderAllReq();

</script>
</body>
</html>
